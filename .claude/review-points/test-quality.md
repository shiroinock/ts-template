# テスト品質チェック

## 説明
テストファイルの品質を確認します。テスト名の正確性、モックの有効性、重複の有無などをチェックします。

## 適用条件
以下のいずれかに該当するファイル:
- ファイル名が `.test.ts` または `.test.tsx` で終わる
- `src/__tests__/` ディレクトリ内のすべてのファイル

## チェック項目

### 1. テストと実装の整合性
- [ ] **テスト名が実際の検証内容を正確に反映しているか**
  - 例：「5つの関数が呼び出される」というテスト名で、実際には「背景がクリアされる」だけを検証している場合は **WARN**
  - テスト名と検証内容が一致していないと、将来のメンテナンス時に混乱を招く
- [ ] **モック（vi.mock, vi.doMock等）が正しく機能しているか**
  - モックが機能していないのにテストがパスしている場合は **WARN**
  - `vi.doMock`は動的インポート前に実行する必要がある点に注意
- [ ] **コメントアウトされたアサーションがある場合、その理由が明記されているか**
  - 意図的にコメントアウトしている場合は TODO コメント等で理由を明記すべき
  - 理由が不明な場合は **WARN**
  - 将来実装予定の検証は、TODOコメントで明確にマークする
- [ ] **スキップされたテスト（test.skip）がある場合、その理由が明記されているか**
  - スキップの理由がコメントで説明されていない場合は **WARN**

### 2. テストの重複チェック
- [ ] **同じことを検証するテストが複数存在していないか**
  - 重複がある場合は **WARN**（ただし、統合は任意）
  - 例：「CoordinateTransformの受け渡し」と「スタブ動作確認」が実質的に同じことを検証
- [ ] **重複している場合、それぞれの意図（観点）が明確に区別されているか**
  - 区別が不明確な場合は **WARN**
  - 異なる観点で検証する場合は、その違いをテスト名や説明コメントで明確にすること
  - 例：「関数Aからの呼び出し時の挙動」vs「直接呼び出し時の挙動」

### 3. Arrange-Act-Assert パターン
- [ ] **テストが AAA パターンに従っているか**
  - Arrange（準備）、Act（実行）、Assert（検証）が明確に分離されているか
  - コメントで各セクションを明示することを推奨

### 4. テストのメンテナンス性
- [ ] **マジックナンバーが適切に定数化されているか**
  - 意味のある数値は定数として定義し、名前をつける
  - 例：`const MAX_RETRY = 3;` instead of `3`
- [ ] **長い配列の期待値が変数として定義されているか**
  - 可読性向上のため、長い配列は変数に抽出することを推奨
  - 例：`const expectedItems = Array.from({length: 10}, (_, i) => i + 1);`

## 重要度
high

## 判定基準
- **PASS**: すべての観点で問題なし
- **WARN**: 以下のいずれかが該当
  - テスト名と内容の不一致
  - モックの不具合
  - テストの重複（軽微）
  - コメントアウトされたアサーションの理由不明
  - スキップされたテストの理由不明
- **FAIL**: 以下のいずれかが該当
  - 複数の重大な問題がある
  - テストが実質的に機能していない
  - テストカバレッジが著しく不足している

## 関連ファイル
- すべてのテストファイル（`*.test.ts`, `*.test.tsx`）
- `src/__tests__/` ディレクトリ
